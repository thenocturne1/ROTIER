import { useState, useEffect, useRef, useCallback } from "react";

const SF = "'Libre Bodoni', Georgia, serif";
const EL = "'Cormorant Garamond', Georgia, serif";
const SN = "'DM Sans', sans-serif";

const photos = [
  "https://images.unsplash.com/photo-1547891654-e66ed7ebb968?w=400&q=80",
  "https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=400&q=80",
  "https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=400&q=80",
  "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&q=80",
  "https://images.unsplash.com/photo-1578926288207-a90a5366759d?w=400&q=80",
];

const panels = [
  { type:"artist", num:"01", name:"Volker Seifried", desc:"Reduktion auf das Wesentliche. Geometrische Strenge trifft organische Form – Material und Raum im Dialog.", tags:["Bronze","Stein","Holz"], img:"https://images.unsplash.com/photo-1547891654-e66ed7ebb968?w=1200&q=80", wide:true },
  { type:"quote", quote:'»Skulptur ist <em>geronnener Raum</em> – sie macht sichtbar, was Architektur verschweigt.«', img:"https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=1200&q=80" },
  { type:"artist", num:"02", name:"Johannes Weiß", desc:"Organische Abstraktion in Aluminium und Bronze. Formen, die Verkörperung und Zeitlichkeit erforschen.", tags:["Aluminium","Bronze","Gips"], img:"https://images.unsplash.com/photo-1578926288207-a90a5366759d?w=1200&q=80", wide:true },
  { type:"quote", quote:'»Kunst in Unternehmensräumen ist kein <em>Luxus</em> – sie ist eine Investition in Kultur.«', img:"https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?w=1200&q=80" },
  { type:"artist", num:"03", name:"Maria Stern", desc:"Abstrakte Farbfelder als Räume emotionaler Tiefe. Großformatige Leinwände für kontemplative Atmosphären.", tags:["Öl","Acryl","Großformat"], img:"https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=1200&q=80", wide:true },
  { type:"quote", quote:'»Ein Raum <em>ohne Kunst</em> ist ein Raum ohne Stimme.«', img:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200&q=80" },
  { type:"artist", num:"04", name:"Lukas Grimm", desc:"Raum als Medium, Licht als Material. Ortsspezifische Installationen, die Architektur transformieren.", tags:["Licht","Installation","Ortsspezifisch"], img:"https://images.unsplash.com/photo-1515405295579-ba7b45403062?w=1200&q=80", wide:true },
  { type:"quote", quote:'»Vier Positionen.<br/><em>Ein Programm.</em><br/>Ihr Raum.«', img:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=1200&q=80" },
];

export default function Kunstleasing() {
  const [view, setView] = useState("about");
  const [dark, setDark] = useState(false);
  const mainRef = useRef(null);
  const kuenstlerRef = useRef(null);
  const kreativeRef = useRef(null);
  const [introIdx, setIntroIdx] = useState(0);
  const [stOpacity, setStOpacity] = useState([0,0,0]);
  const [p2Vis, setP2Vis] = useState(false);
  const [p1Y, setP1Y] = useState(0);
  const [p2Y, setP2Y] = useState(0);
  const [bgOffsets, setBgOffsets] = useState([0,0,0]);

  // Künstler state
  const [kNameOp, setKNameOp] = useState(1);
  const [kWordOp, setKWordOp] = useState(0);
  const [kWordSize, setKWordSize] = useState(2);
  const [kHorVis, setKHorVis] = useState(false);
  const [kHorX, setKHorX] = useState(0);
  const [kCtaVis, setKCtaVis] = useState(false);
  const [kCtaOp, setKCtaOp] = useState(0);
  const [letterFonts, setLetterFonts] = useState([]);
  const [floatingPhotos, setFloatingPhotos] = useState([]);
  const [contactForm, setContactForm] = useState({ name:"", email:"", company:"", message:"" });
  const [formSent, setFormSent] = useState(false);
  const [chatOpen, setChatOpen] = useState(false);
  const [chatMsgs, setChatMsgs] = useState([{ role:"assistant", content:"Willkommen bei Kunstleasing Berlin. Ich bin Ihr persönlicher Berater für Kunst im Unternehmensraum. Wie kann ich Ihnen helfen?" }]);
  const [chatInput, setChatInput] = useState("");
  const [chatLoading, setChatLoading] = useState(false);
  const [showImpressum, setShowImpressum] = useState(false);
  const chatEndRef = useRef(null);
  const flickerRef = useRef(null);
  const photoRef = useRef(null);

  const navItems = [
    { id:"about", label:"Kunstleasing", italic:"K" },
    { id:"kuenstler", label:"Künstler" },
    { id:"prozess", label:"Prozess" },
    { id:"kreative", label:"Referenzen" },
    { id:"leasing", label:"Konditionen" },
    { id:"kontakt", label:"Kontakt" },
  ];

  const goTo = useCallback((v, opts) => {
    setView(v);
    setDark(false);
    setFormSent(false);
    if (v === "kontakt") {
      if (opts?.portfolio) {
        setContactForm({ name:"", email:"", company:"", message:"Ich interessiere mich für Ihr Künstler-Portfolio und möchte gerne mehr über die verfügbaren Werke erfahren." });
      } else {
        setContactForm(prev => ({ ...prev }));
      }
    }
    if (v === "kuenstler") {
      const text = "DIEKÜNSTLER";
      setLetterFonts(text.split("").map(() => SF));
      setKNameOp(1); setKWordOp(0); setKWordSize(2);
      setKHorVis(false); setKHorX(0); setKCtaVis(false); setKCtaOp(0);
      setFloatingPhotos([]);
    }
  }, []);

  // Auto-scroll chat
  useEffect(() => {
    if (chatEndRef.current) chatEndRef.current.scrollIntoView({ behavior:"smooth" });
  }, [chatMsgs, chatLoading]);

  const sendChat = useCallback(async () => {
    if (!chatInput.trim() || chatLoading) return;
    const userMsg = chatInput.trim();
    setChatInput("");
    const newMsgs = [...chatMsgs, { role:"user", content: userMsg }];
    setChatMsgs(newMsgs);
    setChatLoading(true);
    try {
      const systemPrompt = `Du bist der KI-Berater von Kunstleasing Berlin – einer Plattform für Kunstleasing, Ankauf und Beratung für Unternehmen.

DEIN WISSEN:
- Leasing-Modelle: Einzelwerk (ab 150€/Monat), Raumkonzept (ab 400€/Monat, 3-5 Werke), Gebäudekonzept (individuell)
- Laufzeiten: 6-36 Monate, flexibel
- Steuerlich: 100% als Betriebsausgaben absetzbar (§4 Abs.4 EStG)
- Inklusiv: Transport, Versicherung (Nail-to-Nail), Montage, Wartung, Vermittlung, Ankauf-Option
- Rotation: Werke können getauscht werden

KÜNSTLER:
- Volker Seifried: Skulptur (Bronze, Stein, Holz) – geometrische Strenge trifft organische Form
- Johannes Weiß: Skulptur (Aluminium, Bronze) – organische Abstraktion, studierte bei Prof. Tony Cragg, UdK Berlin
- Maria Stern: Malerei (Öl, Acryl, Großformat) – abstrakte Farbfelder
- Lukas Grimm: Installation (Licht, ortsspezifisch) – Raum als Medium

PROZESS: 1) Raumanalyse 2) Kuratorische Auswahl 3) Vertrag 4) Installation 5) Betreuung & Rotation
REFERENZEN: Kanzlei Müller & Partner, Hotel Lindenberg, TechVentures GmbH

STIL: Professionell, kompetent, warm. Deutsch. Max 3-4 Sätze. Bei Interesse empfiehl info@kunstleasing.de oder +49 30 1234 5678.`;

      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1000,
          system: systemPrompt,
          messages: newMsgs.map(m => ({ role: m.role, content: m.content })),
        }),
      });
      const data = await response.json();
      const reply = data.content?.map(c => c.text || "").join("") || "Entschuldigung, bitte kontaktieren Sie uns direkt unter info@kunstleasing.de.";
      setChatMsgs(prev => [...prev, { role:"assistant", content: reply }]);
    } catch (e) {
      setChatMsgs(prev => [...prev, { role:"assistant", content:"Entschuldigung, es gab ein technisches Problem. Bitte kontaktieren Sie uns unter info@kunstleasing.de oder +49 30 1234 5678." }]);
    }
    setChatLoading(false);
  }, [chatInput, chatMsgs, chatLoading]);

  // Flickering letters for Künstler
  useEffect(() => {
    if (view !== "kuenstler") { clearInterval(flickerRef.current); clearInterval(photoRef.current); return; }
    flickerRef.current = setInterval(() => {
      setLetterFonts(prev => {
        const n = [...prev];
        const i = Math.floor(Math.random() * n.length);
        n[i] = n[i] === SF ? SN : SF;
        return n;
      });
    }, 1200);
    photoRef.current = setInterval(() => {
      setFloatingPhotos(prev => {
        if (prev.length >= 3) return prev;
        const positions = [
          { x: 3 + Math.random() * 12, y: 5 + Math.random() * 25 },
          { x: 55 + Math.random() * 15, y: 50 + Math.random() * 20 },
          { x: 25 + Math.random() * 20, y: 15 + Math.random() * 30 },
        ];
        const pos = positions[prev.length] || { x: Math.random() * 60 + 10, y: Math.random() * 50 + 10 };
        return [...prev, {
          id: Date.now() + Math.random(),
          url: photos[Math.floor(Math.random() * photos.length)],
          x: pos.x,
          y: pos.y,
          w: 200 + Math.random() * 160,
          born: Date.now(),
        }];
      });
    }, 2800);
    return () => { clearInterval(flickerRef.current); clearInterval(photoRef.current); };
  }, [view]);

  // Remove old photos
  useEffect(() => {
    if (view !== "kuenstler") return;
    const t = setInterval(() => {
      setFloatingPhotos(prev => prev.filter(p => Date.now() - p.born < 5000));
    }, 800);
    return () => clearInterval(t);
  }, [view]);

  // Main scroll handler
  const onMainScroll = useCallback(() => {
    const el = mainRef.current;
    if (!el) return;
    const st = el.scrollTop, vh = window.innerHeight;
    const pr = st / (320 * vh / 100);
    setIntroIdx(Math.min(2, Math.floor(pr * 3)));
    setP1Y(st * 0.15);
    setP2Vis(pr > 0.3);
    setP2Y((st - vh) * 0.1);

    // Statement
    const sz = document.getElementById("stZone");
    if (sz) {
      const r = sz.getBoundingClientRect();
      if (r.top < vh && r.bottom > 0) {
        const sp = (vh - r.top) / (vh + r.height);
        const ops = [0,1,2].map(i => {
          const ls = 0.2 + i * 0.15, le = ls + 0.2;
          if (sp > ls && sp < le) return Math.min(1, (sp - ls) / 0.1);
          if (sp >= le) return Math.max(0, 1 - (sp - le) / 0.1);
          return 0;
        });
        setStOpacity(ops);
      }
    }

    // Parallax bgs
    const bgs = el.querySelectorAll("[data-parbg]");
    const offsets = [];
    bgs.forEach(bg => {
      const s = bg.parentElement;
      const r = s.getBoundingClientRect();
      const p = (vh - r.top) / (vh + r.height);
      offsets.push((p - 0.5) * 80);
    });
    setBgOffsets(offsets);
  }, []);

  // Künstler scroll handler
  const onKuenstlerScroll = useCallback(() => {
    const el = kuenstlerRef.current;
    if (!el) return;
    const st = el.scrollTop;
    const th = 1200 * window.innerHeight / 100;
    const pr = st / th;

    // Phase 1: Name
    if (pr < 0.05) { setKNameOp(1 - pr / 0.05); } else { setKNameOp(0); }

    // Phase 2: Growing words
    if (pr >= 0.04 && pr < 0.10) {
      const gp = (pr - 0.04) / 0.06;
      const fp = pr > 0.08 ? (pr - 0.08) / 0.02 : 0;
      setKWordOp(1 - fp);
      setKWordSize(3 + 12 * Math.min(1, gp));
    } else {
      setKWordOp(0);
    }

    // Phase 3: Horizontal
    if (pr >= 0.10 && pr <= 0.90) {
      setKHorVis(true);
      setKHorX(-((pr - 0.10) / 0.80) * 8 * 84);
      setKCtaVis(false);
      setDark(true);
    } else if (pr < 0.10) {
      setKHorVis(false);
      setDark(false);
    }

    // Phase 4: CTA
    if (pr > 0.88) {
      setKHorVis(false);
      setKCtaVis(true);
      setKCtaOp((pr - 0.88) / 0.12);
      setDark(true);
    } else {
      setKCtaOp(0);
      setKCtaVis(false);
    }
  }, []);

  // Kreative parallax
  const onKreativeScroll = useCallback(() => {
    const el = kreativeRef.current;
    if (!el) return;
    const vh = window.innerHeight;
    el.querySelectorAll("[data-kbg]").forEach(bg => {
      const s = bg.parentElement;
      const r = s.getBoundingClientRect();
      const p = (vh - r.top) / (vh + r.height);
      bg.style.transform = `translateY(${(p - 0.5) * 80}px)`;
    });
  }, []);

  const stWords = ["Skulptur", "Malerei", "Installation"];
  const introTexts = [
    "Kunst verändert Räume. Sie transformiert Arbeitsumgebungen, inspiriert Mitarbeiter und Kunden, und schafft Atmosphären, die in Erinnerung bleiben.",
    "Wir kuratieren zeitgenössische Positionen für Unternehmen, Hotels und öffentliche Räume – mit einem Leasing-Modell, das Flexibilität und steuerliche Vorteile verbindet.",
    "Jedes Werk wird individuell ausgewählt. Jede Installation professionell begleitet. Jeder Raum als Gesamtkonzept gedacht.",
  ];

  const isAbout = view === "about";

  return (
    <div style={{ width:"100%", height:"100vh", fontFamily:SN, background:"#fff", overflow:"hidden", position:"relative" }}>
      <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=Libre+Bodoni:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

      {/* HEADER */}
      <div style={{ position:"fixed", top:0, left:0, right:0, zIndex:10002, padding:"20px 28px", display:"flex", justifyContent:"center", alignItems:"center", background: dark ? "rgba(0,0,0,0.95)" : "rgba(255,255,255,0.97)", backdropFilter:"blur(8px)", transition:"background 0.5s" }}>
        <div style={{ display:"flex", alignItems:"center", gap:28, flexWrap:"wrap", justifyContent:"center" }}>
          {navItems.map(n => (
            <button key={n.id} onClick={() => goTo(n.id)} style={{ fontSize:9, fontWeight:500, letterSpacing:"0.14em", textTransform:"uppercase", cursor:"pointer", background:"none", border:"none", padding:"8px 4px", color: dark ? "#fff" : "#000", transition:"opacity 0.3s", whiteSpace:"nowrap", opacity: view === n.id ? 1 : 0.4, fontFamily:SN }}>
              {n.italic ? <><span style={{ fontStyle:"italic", fontFamily:EL }}>{n.italic}</span>{n.label.slice(1)}</> : n.label}
            </button>
          ))}
        </div>
      </div>

      {/* ===== ABOUT / MAIN ===== */}
      {isAbout && (
        <div ref={mainRef} onScroll={onMainScroll} style={{ height:"100vh", width:"100%", overflowY:"auto", overflowX:"hidden", background:"#fff" }}>
          {/* Hero */}
          <div style={{ minHeight:"320vh", position:"relative", display:"flex", flexDirection:"column", alignItems:"center", padding:"0 28px" }}>
            {/* Right image - full screen height, scrolls with page */}
            <div style={{ position:"absolute", right:0, top:0, width:"50vw", height:"100vh", opacity:0.92, overflow:"hidden", zIndex:0 }}>
              <img src="https://images.unsplash.com/photo-1561214115-f2f134cc4912?w=1200&q=80" alt="" style={{ width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%)" }} />
            </div>
            {/* Left image - full screen height, fades in when scrolling, starts below first screen */}
            <div style={{ position:"absolute", left:0, top:"100vh", width:"50vw", height:"100vh", opacity: p2Vis ? 0.9 : 0, transition:"opacity 1.2s ease", overflow:"hidden", zIndex:0 }}>
              <img src="https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=1200&q=80" alt="" style={{ width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%)" }} />
            </div>
            <div style={{ position:"sticky", top:"50%", transform:"translateY(-50%)", width:"100%", maxWidth:900, display:"flex", flexDirection:"column", alignItems:"center", zIndex:2 }}>
              <h1 style={{ fontFamily:SF, fontSize:"clamp(72px,22vw,200px)", fontWeight:400, lineHeight:0.82, letterSpacing:"-0.02em", textAlign:"center" }}>
                <span style={{ fontStyle:"italic" }}>K</span>unst
              </h1>
              <p style={{ fontSize:10, fontWeight:500, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginTop:16 }}>für Räume, die wirken</p>
              <div style={{ position:"relative", height:120, width:"100%", maxWidth:500, marginTop:24 }}>
                {introTexts.map((t,i) => (
                  <p key={i} style={{ fontSize:14, lineHeight:1.5, textAlign:"center", position:"absolute", top:0, left:0, right:0, opacity: i === introIdx ? 1 : 0, transition:"opacity 0.6s" }}>{t}</p>
                ))}
              </div>
            </div>
          </div>

          {/* Manifest */}
          <div style={{ minHeight:"100vh", padding:"120px 28px", display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center" }}>
            <div style={{ maxWidth:700, textAlign:"center" }}>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(24px,5vw,42px)", fontWeight:400, lineHeight:1.25, letterSpacing:"-0.02em", marginBottom:48 }}>
                Kunst ist kein Dekor.<br/><span style={{ fontStyle:"italic", fontFamily:EL }}>S</span>ie ist eine Haltung.
              </h2>
              <p style={{ fontSize:14, lineHeight:1.8, opacity:0.75, marginBottom:32 }}>Wir glauben, dass Räume durch Kunst eine Identität gewinnen, die weit über ästhetische Aufwertung hinausgeht. Skulpturen, Malerei und Installationen schaffen Dialogräume – zwischen Werk und Betrachter, zwischen Unternehmen und Kultur.</p>
              <p style={{ fontFamily:EL, fontSize:12, fontStyle:"italic", opacity:0.5 }}>— Kunstleasing Berlin</p>
            </div>
          </div>

          {/* Stats */}
          <div style={{ display:"flex", justifyContent:"center", gap:60, padding:"80px 28px", background:"#f5f5f5", flexWrap:"wrap" }}>
            {[["100%","steuerlich absetzbar als Betriebsausgabe"],["6–36","Monate flexible Vertragslaufzeit"],["∞","Rotation & Werkwechsel möglich"]].map(([n,t],i) => (
              <div key={i} style={{ textAlign:"center" }}>
                <div style={{ fontFamily:SF, fontSize:"clamp(48px,10vw,80px)", fontWeight:400, letterSpacing:"-0.03em", lineHeight:1 }}>{n}</div>
                <div style={{ fontSize:11, letterSpacing:"0.1em", textTransform:"uppercase", opacity:0.5, marginTop:12, maxWidth:140 }}>{t}</div>
              </div>
            ))}
          </div>

          {/* Statement Zone */}
          <div id="stZone" style={{ height:"150vh", position:"relative" }}>
            <div style={{ position:"sticky", top:"20%", minHeight:"60vh", display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", padding:"40px 28px" }}>
              {stWords.map((w,i) => (
                <div key={i} style={{ fontFamily:SF, fontSize:"clamp(40px,11vw,100px)", fontWeight:400, lineHeight:1.1, letterSpacing:"-0.03em", opacity:stOpacity[i], padding:"5px 0", fontStyle: i===1 ? "italic" : "normal" }}>{w}</div>
              ))}
            </div>
          </div>

          {/* Parallax Sections */}
          {[
            { img:"https://images.unsplash.com/photo-1547891654-e66ed7ebb968?w=1400&q=80", label:"Skulptur", title:"Körper im Raum", text:"Dreidimensionale Werke, die Architektur und Kunst in einen Dialog bringen.", artist:"Volker Seifried · Johannes Weiß", right:false },
            { img:"https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=1400&q=80", label:"Malerei", title:"Farbfeld & Tiefe", text:"Abstrakte und figurative Positionen, die Räume durch Farbe, Textur und kompositorische Spannung definieren.", artist:"Maria Stern", right:true },
            { img:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1400&q=80", label:"Installation", title:"Raum als Medium", text:"Ortsspezifische Interventionen, die Licht, Material und Architektur zu einem Gesamterlebnis verbinden.", artist:"Lukas Grimm", right:false },
          ].map((s,i) => (
            <div key={i} style={{ position:"relative", overflow:"hidden", background:"#f5f5f5", minHeight:"70vh" }}>
              <div data-parbg="1" style={{ position:"absolute", top:0, left:0, right:0, bottom:0, zIndex:1, transform:`translateY(${bgOffsets[i]||0}px)` }}>
                <img src={s.img} alt="" style={{ width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%)" }} />
              </div>
              <div style={{ position:"relative", zIndex:2, display:"flex", flexDirection:"column", justifyContent:"center", alignItems: s.right ? "flex-end" : "flex-start", padding:"100px 80px", minHeight:"70vh" }}>
                <div style={{ background:"rgba(255,255,255,0.98)", padding:36, maxWidth:420, boxShadow:"0 8px 32px rgba(0,0,0,0.12)" }}>
                  <div style={{ fontSize:9, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.5, marginBottom:10 }}>{s.label}</div>
                  <h3 style={{ fontFamily:SF, fontSize:"clamp(22px,3.5vw,30px)", fontWeight:400, lineHeight:1.1, letterSpacing:"-0.02em", marginBottom:12 }}>{s.title}</h3>
                  <p style={{ fontSize:13, lineHeight:1.6, opacity:0.8, marginBottom:12 }}>{s.text}</p>
                  <div style={{ fontSize:10, fontWeight:500, letterSpacing:"0.08em", textTransform:"uppercase", opacity:0.6 }}>{s.artist}</div>
                </div>
              </div>
            </div>
          ))}

          {/* Leasing Teaser */}
          <div onClick={() => goTo("leasing")} style={{ padding:"80px 28px", background:"#f8f8f8", cursor:"pointer", transition:"background 0.3s" }}>
            <div style={{ maxWidth:1000, margin:"0 auto", display:"grid", gridTemplateColumns:"1fr 1fr", gap:40, alignItems:"center" }}>
              <div>
                <h2 style={{ fontFamily:SF, fontSize:"clamp(32px,7vw,56px)", fontWeight:300, lineHeight:1, marginBottom:20 }}>
                  <span style={{ fontStyle:"italic", fontFamily:EL }}>L</span>easing
                </h2>
                <p style={{ fontSize:14, lineHeight:1.7, opacity:0.7, marginBottom:16 }}>Kunst ohne Kapitalbindung. Leasingraten sind als Betriebsausgaben voll absetzbar.</p>
                <span style={{ fontSize:12, letterSpacing:"0.1em", textTransform:"uppercase", opacity:0.5 }}>Konditionen ansehen →</span>
              </div>
              <div style={{ display:"flex", flexWrap:"wrap", gap:10 }}>
                {["Skulptur","Malerei","Installation","Fotografie","Objekt","Kunst am Bau","Rotation","Ankauf-Option"].map(t => (
                  <span key={t} style={{ fontSize:11, padding:"8px 14px", background:"#fff", border:"1px solid rgba(0,0,0,0.08)", borderRadius:100 }}>{t}</span>
                ))}
              </div>
            </div>
          </div>

          {/* Method */}
          <div style={{ padding:"120px 28px", background:"#000", color:"#fff" }}>
            <div style={{ maxWidth:1100, margin:"0 auto" }}>
              <div style={{ textAlign:"center", marginBottom:100 }}>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:16 }}>Unser Prozess</div>
                <h2 style={{ fontFamily:SF, fontSize:"clamp(44px,12vw,100px)", fontWeight:400, lineHeight:0.92, letterSpacing:"-0.02em" }}>Von der <span style={{ fontStyle:"italic" }}>Idee</span> zum Raum</h2>
              </div>
              <div style={{ display:"flex", gap:2, overflowX:"auto", marginTop:80, paddingBottom:20, WebkitOverflowScrolling:"touch", scrollbarWidth:"none" }}>
                {[
                  ["01","Beratung","Wir analysieren Ihre Räume und entwickeln ein Konzept, das Architektur und Identität verbindet."],
                  ["02","Kuration","Aus unserem Netzwerk wählen wir Positionen, die zu Ihrem Raum und Ihrer Vision passen."],
                  ["03","Installation","Professioneller Transport, fachgerechte Montage und Versicherung."],
                  ["04","Betreuung","Regelmäßige Wartung, Dokumentation und Vermittlung."],
                  ["05","Rotation","Auf Wunsch tauschen wir Werke aus – neue Impulse für Ihre Räume."],
                ].map(([n,t,d]) => (
                  <div key={n} style={{ background:"rgba(255,255,255,0.03)", padding:"40px 28px", minWidth:220, flex:"1 0 220px" }}>
                    <div style={{ fontSize:11, letterSpacing:"0.15em", opacity:0.3, marginBottom:20 }}>{n}</div>
                    <h3 style={{ fontFamily:SF, fontSize:22, fontWeight:400, marginBottom:16 }}>{t}</h3>
                    <p style={{ fontSize:13, lineHeight:1.6, opacity:0.6 }}>{d}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* CTA */}
          <div style={{ minHeight:"100vh", display:"flex", flexDirection:"column", justifyContent:"center", alignItems:"center", padding:"80px 28px", background:"#000" }}>
            <h2 style={{ fontFamily:EL, fontSize:"clamp(44px,12vw,110px)", fontWeight:300, lineHeight:0.95, textAlign:"center", marginBottom:40, color:"#fff", letterSpacing:"-0.02em" }}>Lassen Sie<br/><span style={{ fontStyle:"italic" }}>uns sprechen</span></h2>
            <button onClick={() => setChatOpen(true)} style={{ padding:"16px 48px", fontSize:11, fontWeight:500, letterSpacing:"0.15em", textTransform:"uppercase", border:"none", cursor:"pointer", background:"#fff", color:"#000" }}>Beratung anfragen</button>
          </div>
        </div>
      )}

      {/* ===== KÜNSTLER ===== */}
      {view === "kuenstler" && (
        <div ref={kuenstlerRef} onScroll={onKuenstlerScroll} style={{ position:"fixed", inset:0, zIndex:100, overflowY:"scroll", overflowX:"hidden", background:"#fff", WebkitOverflowScrolling:"touch" }}>
          <div style={{ height:"1200vh" }} />
          {/* Floating photos */}
          <div style={{ position:"fixed", inset:0, zIndex:10, pointerEvents:"none", overflow:"hidden" }}>
            {floatingPhotos.map(p => {
              const age = Date.now() - p.born;
              const fadeIn = Math.min(1, age / 1200);
              const fadeOut = age > 3800 ? Math.max(0, 1 - (age - 3800) / 1200) : 1;
              const op = kNameOp > 0.3 ? fadeIn * fadeOut * 0.8 : 0;
              return (
                <div key={p.id} style={{ position:"absolute", left:`${p.x}%`, top:`${p.y}%`, width:p.w, height:p.w * 1.2, opacity:op, transition:"opacity 1.5s ease", transform:`translateY(${-age * 0.005}px)` }}>
                  <img src={p.url} alt="" style={{ width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%)" }} />
                </div>
              );
            })}
          </div>
          {/* Name */}
          <div style={{ position:"fixed", top:"50%", left:"50%", transform:"translate(-50%,-50%)", zIndex:20, pointerEvents:"none", textAlign:"center", width:"90%", maxWidth:900, opacity:kNameOp, transition:"opacity 0.5s" }}>
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:0 }}>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(44px,12vw,130px)", fontWeight:400, letterSpacing:"-0.03em", lineHeight:0.85, textAlign:"right", paddingRight:"0.15em", color:"#000" }}>
                {["D","I","E"].map((c,i) => (
                  <span key={i} style={{ fontFamily: letterFonts[i] || SF, display:"inline-block", transition:"font-family 0.8s ease" }}>{c}</span>
                ))}
              </h2>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(44px,12vw,130px)", fontWeight:400, letterSpacing:"-0.03em", lineHeight:0.85, textAlign:"left", paddingLeft:"0.15em", color:"#000" }}>
                {["K","Ü","N","S","T","L","E","R"].map((c,i) => (
                  <span key={i} style={{ fontFamily: letterFonts[i+3] || SF, display:"inline-block", transition:"font-family 0.8s ease" }}>{c}</span>
                ))}
              </h2>
            </div>
            <p style={{ fontSize:11, letterSpacing:"0.15em", textTransform:"uppercase", opacity:0.4, marginTop:28 }}>Kuratierte Positionen</p>
          </div>
          {/* Growing words */}
          <div style={{ position:"fixed", top:"50%", left:"50%", transform:"translate(-50%,-50%)", zIndex:5, pointerEvents:"none", textAlign:"center", display:"flex", flexDirection:"column", alignItems:"center", width:"100%" }}>
            {["Skulptur","Malerei","Installation"].map((w,i) => (
              <span key={i} style={{ fontFamily:SF, fontWeight:400, letterSpacing:"-0.02em", textTransform:"uppercase", margin:"5px 0", opacity:kWordOp, color:"#000", fontSize:`${kWordSize}vw`, lineHeight:1, display:"block" }}>{w}</span>
            ))}
          </div>
          {/* Horizontal scroll */}
          {kHorVis && (
            <div style={{ position:"fixed", inset:0, zIndex:30, display:"flex", alignItems:"center", overflow:"hidden", background:"#0a0a0a", pointerEvents:"none", opacity:1, transition:"opacity 0.8s" }}>
              <div style={{ display:"flex", alignItems:"center", willChange:"transform", transform:`translateX(${kHorX}vw)`, gap:"4vw", padding:"0 10vw" }}>
                {panels.map((p,i) => (
                  <div key={i} style={{ flexShrink:0, width: p.wide ? "85vw" : "75vw", height:"75vh", position:"relative", borderRadius:12, overflow:"hidden" }}>
                    <img src={p.img} alt="" style={{ position:"absolute", inset:0, width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%) brightness(0.7)" }} />
                    <div style={{ position:"absolute", inset:0, background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0) 100%)", zIndex:5 }} />
                    <div style={{ position:"absolute", bottom: p.type==="quote" ? "50%" : 0, transform: p.type==="quote" ? "translateY(50%)" : "none", left:0, right:0, padding: p.type==="quote" ? "48px 64px" : 48, zIndex:10, color:"#fff", textAlign: p.type==="quote" ? "center" : "left" }}>
                      {p.type === "artist" ? (
                        <>
                          <div style={{ fontSize:11, letterSpacing:"0.3em", opacity:0.4, marginBottom:16, fontWeight:500 }}>{p.num}</div>
                          <h3 style={{ fontFamily:SF, fontSize:"clamp(28px,4vw,42px)", fontWeight:400, lineHeight:1.1, marginBottom:16, letterSpacing:"-0.02em" }}>{p.name}</h3>
                          <p style={{ fontSize:14, lineHeight:1.7, opacity:0.7, maxWidth:400 }}>{p.desc}</p>
                          <div style={{ display:"flex", flexWrap:"wrap", gap:8, marginTop:20 }}>
                            {p.tags.map(t => (
                              <span key={t} style={{ padding:"8px 16px", border:"1px solid rgba(255,255,255,0.25)", fontSize:9, letterSpacing:"0.15em", textTransform:"uppercase", color:"rgba(255,255,255,0.8)", borderRadius:2 }}>{t}</span>
                            ))}
                          </div>
                        </>
                      ) : (
                        <p style={{ fontFamily:SF, fontSize:"clamp(24px,3.5vw,36px)", lineHeight:1.3, fontWeight:400 }} dangerouslySetInnerHTML={{ __html: p.quote }} />
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          {/* CTA */}
          {kCtaVis && (
            <div style={{ position:"fixed", inset:0, zIndex:70, display:"flex", flexDirection:"column", justifyContent:"center", alignItems:"center", background:"#000", opacity:kCtaOp, pointerEvents: kCtaOp > 0.5 ? "auto" : "none" }}>
              <h2 style={{ fontFamily:EL, fontSize:"clamp(44px,12vw,110px)", fontWeight:300, lineHeight:0.95, textAlign:"center", marginBottom:24, color:"#fff" }}>Künstler<br/><span style={{ fontStyle:"italic" }}>entdecken</span></h2>
              <div style={{ marginBottom:32 }}>
                {["Volker Seifried","Johannes Weiß","Maria Stern","Lukas Grimm"].map(n => (
                  <span key={n} style={{ display:"inline-block", padding:"6px 16px", border:"1px solid rgba(255,255,255,0.3)", fontSize:9, letterSpacing:"0.15em", textTransform:"uppercase", margin:4, color:"#fff" }}>{n}</span>
                ))}
              </div>
              <button onClick={() => goTo("kontakt", { portfolio: true })} style={{ padding:"16px 48px", fontSize:11, fontWeight:500, letterSpacing:"0.15em", textTransform:"uppercase", border:"none", cursor:"pointer", background:"#fff", color:"#000" }}>Portfolio anfragen</button>
            </div>
          )}
        </div>
      )}

      {/* ===== PROZESS ===== */}
      {view === "prozess" && (
        <div style={{ position:"fixed", inset:0, zIndex:100, background:"#fff", overflowY:"auto" }}>
          <div style={{ maxWidth:1100, margin:"0 auto", padding:"120px 28px 80px" }}>
            <div style={{ textAlign:"center", marginBottom:100 }}>
              <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:16 }}>Schritt für Schritt</div>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(44px,12vw,100px)", fontWeight:400, lineHeight:0.92, letterSpacing:"-0.02em" }}>Der <span style={{ fontStyle:"italic" }}>Weg</span> zum Werk</h2>
            </div>
            <div style={{ maxWidth:700, margin:"0 auto", display:"grid", gap:60 }}>
              {[
                ["01","Raumanalyse & Gespräch","Wir besuchen Ihre Räume, verstehen die architektonischen Gegebenheiten und lernen Ihre Unternehmenskultur kennen."],
                ["02","Kuratorische Auswahl","Basierend auf unserer Analyse stellen wir eine Auswahl zeitgenössischer Positionen zusammen."],
                ["03","Vertragsgestaltung","Flexible Laufzeiten von 6 bis 36 Monaten. Monatliche Raten, die als Betriebsausgaben voll steuerlich absetzbar sind."],
                ["04","Installation & Einrichtung","Professioneller Kunsttransport, fachgerechte Montage und Beleuchtungsberatung. Alles aus einer Hand."],
                ["05","Betreuung & Rotation","Regelmäßige Pflege der Werke, Vermittlungsgespräche für Mitarbeiter und Gäste. Auf Wunsch Rotation."],
              ].map(([n,t,d]) => (
                <div key={n} style={{ display:"grid", gridTemplateColumns:"60px 1fr", gap:28, alignItems:"start" }}>
                  <div style={{ fontFamily:SF, fontSize:48, fontWeight:400, opacity:0.15, lineHeight:1 }}>{n}</div>
                  <div>
                    <h3 style={{ fontFamily:SF, fontSize:24, fontWeight:400, marginBottom:12 }}>{t}</h3>
                    <p style={{ fontSize:14, lineHeight:1.8, opacity:0.65 }}>{d}</p>
                  </div>
                </div>
              ))}
            </div>
            <div style={{ textAlign:"center", marginTop:100 }}>
              <button onClick={() => setChatOpen(true)} style={{ padding:"16px 48px", fontSize:11, fontWeight:500, letterSpacing:"0.15em", textTransform:"uppercase", border:"none", cursor:"pointer", background:"#000", color:"#fff" }}>Beratung anfragen</button>
            </div>
          </div>
        </div>
      )}

      {/* ===== REFERENZEN ===== */}
      {view === "kreative" && (
        <div ref={kreativeRef} onScroll={onKreativeScroll} style={{ position:"fixed", inset:0, zIndex:100, background:"#fff", overflowY:"auto" }}>
          {[
            { img:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=1400&q=80", label:"Referenz 01", title:"Kanzlei Müller & Partner", text:"Skulpturale Intervention im Empfangsbereich. Drei Werke schaffen eine Atmosphäre konzentrierter Ruhe.", right:false },
            { img:"https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=1400&q=80", label:"Referenz 02", title:"Hotel Lindenberg", text:"Großformatige Malerei in Lobby und Suiten. Farbfelder als Brücke zwischen Architektur und Erleben.", right:true },
            { img:"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1400&q=80", label:"Referenz 03", title:"TechVentures GmbH", text:"Lichtinstallation im Hauptquartier – eine ortsspezifische Arbeit, die den Rhythmus des Unternehmens übersetzt.", right:false },
          ].map((s,i) => (
            <div key={i} style={{ position:"relative", minHeight:"100vh", display:"flex", alignItems:"center", overflow:"hidden" }}>
              <div data-kbg="1" style={{ position:"absolute", inset:"-20% 0", zIndex:1, willChange:"transform" }}>
                <img src={s.img} alt="" style={{ width:"100%", height:"100%", objectFit:"cover", filter:"grayscale(100%)" }} />
              </div>
              <div style={{ position:"relative", zIndex:2, padding:"100px 40px", width:"100%" }}>
                <div style={{ background:"rgba(255,255,255,0.97)", padding:48, maxWidth:480, boxShadow:"0 12px 48px rgba(0,0,0,0.15)", marginLeft: s.right ? "auto" : 0 }}>
                  <div style={{ fontSize:9, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>{s.label}</div>
                  <h3 style={{ fontFamily:SF, fontSize:"clamp(28px,5vw,40px)", fontWeight:400, lineHeight:1.1, letterSpacing:"-0.02em", marginBottom:16 }}>{s.title}</h3>
                  <p style={{ fontSize:14, lineHeight:1.7, opacity:0.7 }}>{s.text}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* ===== KONDITIONEN ===== */}
      {view === "leasing" && (
        <div style={{ position:"fixed", inset:0, zIndex:100, background:"#fff", overflowY:"auto" }}>
          <div style={{ maxWidth:1200, margin:"0 auto", padding:"120px 28px 80px" }}>
            <div style={{ marginBottom:48 }}>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(42px,10vw,80px)", fontWeight:300, lineHeight:1, marginBottom:24 }}>
                <span style={{ fontStyle:"italic", fontFamily:EL }}>K</span>onditionen
              </h2>
              <p style={{ fontSize:15, lineHeight:1.7, opacity:0.7, maxWidth:700 }}>Transparente Konditionen für Kunst im Raum. Alle Leasing-Modelle sind als Betriebsausgaben steuerlich absetzbar.</p>
            </div>
            <div style={{ marginBottom:60 }}>
              <div style={{ fontSize:11, letterSpacing:"0.15em", textTransform:"uppercase", opacity:0.4, marginBottom:24, paddingBottom:12, borderBottom:"1px solid rgba(0,0,0,0.1)" }}>Leasing-Modelle</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))", gap:20 }}>
                {[
                  ["Einzelwerk","Ab 150 € / Monat","Ein ausgewähltes Werk für Ihren Raum. Ideal als Einstieg."],
                  ["Raumkonzept","Ab 400 € / Monat","Drei bis fünf Werke, kuratorisch aufeinander abgestimmt."],
                  ["Gebäudekonzept","Individuell","Umfassende Kunstausstattung für ganze Etagen oder Gebäude."],
                ].map(([n,s,d]) => (
                  <div key={n} style={{ background:"#fff", padding:"28px 24px", border:"1px solid rgba(0,0,0,0.06)", transition:"all 0.3s" }}>
                    <div style={{ fontFamily:SF, fontSize:20, fontWeight:400, marginBottom:4 }}>{n}</div>
                    <div style={{ fontSize:11, fontStyle:"italic", opacity:0.4, marginBottom:12 }}>{s}</div>
                    <div style={{ fontSize:12, lineHeight:1.6, opacity:0.7 }}>{d}</div>
                  </div>
                ))}
              </div>
            </div>
            <div style={{ marginBottom:60 }}>
              <div style={{ fontSize:11, letterSpacing:"0.15em", textTransform:"uppercase", opacity:0.4, marginBottom:24, paddingBottom:12, borderBottom:"1px solid rgba(0,0,0,0.1)" }}>Inklusivleistungen</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))", gap:20 }}>
                {[
                  ["Transport","Professioneller Kunsttransport. Bundesweit und international."],
                  ["Versicherung","Allgefahrenversicherung (Nail-to-Nail) für die gesamte Vertragslaufzeit."],
                  ["Montage","Fachgerechte Installation und Hängung. Bei Bedarf mit Beleuchtungskonzept."],
                  ["Wartung","Regelmäßige Kontrolle und Pflege. Bei Beschädigung: Restaurierung oder Ersatz."],
                  ["Vermittlung","Werkbeschreibungen, Führungen für Mitarbeiter und Kunden."],
                  ["Ankauf-Option","Am Ende der Laufzeit können Sie Werke zum reduzierten Restwert übernehmen."],
                ].map(([n,d]) => (
                  <div key={n} style={{ background:"#fff", padding:"28px 24px", border:"1px solid rgba(0,0,0,0.06)" }}>
                    <div style={{ fontFamily:SF, fontSize:20, fontWeight:400, marginBottom:4 }}>{n}</div>
                    <div style={{ fontSize:12, lineHeight:1.6, opacity:0.7 }}>{d}</div>
                  </div>
                ))}
              </div>
            </div>
            <div style={{ padding:24, background:"rgba(0,0,0,0.03)", borderLeft:"3px solid #000" }}>
              <p style={{ fontSize:13, lineHeight:1.6, opacity:0.8 }}><strong>Steuerlicher Hinweis:</strong> Leasingraten für Kunst sind als Betriebsausgaben in voller Höhe steuerlich absetzbar (§ 4 Abs. 4 EStG).</p>
            </div>
            <div style={{ textAlign:"center", marginTop:60, paddingBottom:60 }}>
              <button onClick={() => setChatOpen(true)} style={{ padding:"16px 48px", fontSize:11, fontWeight:500, letterSpacing:"0.15em", textTransform:"uppercase", border:"none", cursor:"pointer", background:"#000", color:"#fff" }}>Individuelles Angebot anfragen</button>
            </div>
          </div>
        </div>
      )}

      {/* ===== KONTAKT ===== */}
      {view === "kontakt" && (
        <div style={{ position:"fixed", inset:0, zIndex:100, background:"#fff", overflowY:"auto" }}>
          <div style={{ maxWidth:800, margin:"0 auto", padding:"140px 28px 80px" }}>
            <h2 style={{ fontFamily:SF, fontSize:"clamp(44px,12vw,90px)", fontWeight:300, lineHeight:1, letterSpacing:"-0.02em", marginBottom:40 }}>
              <span style={{ fontStyle:"italic", fontFamily:EL }}>K</span>ontakt
            </h2>
            <p style={{ fontSize:15, lineHeight:1.7, opacity:0.6, maxWidth:500 }}>Lassen Sie uns über Kunst in Ihren Räumen sprechen.</p>
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:60, marginTop:40 }}>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:16 }}>Adresse</div>
                <div style={{ fontSize:15, lineHeight:1.8 }}>Kunstleasing Berlin<br/>Musterstraße 12<br/>10999 Berlin</div>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:16 }}>Kontakt</div>
                <div style={{ fontSize:15, lineHeight:1.8 }}>
                  <a href="mailto:info@kunstleasing.de" style={{ color:"#000", textDecoration:"none", borderBottom:"1px solid rgba(0,0,0,0.2)" }}>info@kunstleasing.de</a><br/>
                  <a href="tel:+493012345678" style={{ color:"#000", textDecoration:"none", borderBottom:"1px solid rgba(0,0,0,0.2)" }}>+49 30 1234 5678</a>
                </div>
              </div>
            </div>
            {formSent ? (
              <div style={{ marginTop:60, padding:"60px 0", textAlign:"center" }}>
                <div style={{ fontSize:48, marginBottom:20 }}>✓</div>
                <h3 style={{ fontFamily:SF, fontSize:28, fontWeight:400, marginBottom:16 }}>Vielen Dank</h3>
                <p style={{ fontSize:14, lineHeight:1.7, opacity:0.6 }}>Ihre Nachricht wurde gesendet. Wir melden uns in Kürze bei Ihnen.</p>
              </div>
            ) : (
              <div style={{ marginTop:60 }}>
                <input value={contactForm.name} onChange={e => setContactForm(p => ({...p, name:e.target.value}))} placeholder="Name" style={{ width:"100%", padding:"16px 0", fontSize:15, border:"none", borderBottom:"1px solid rgba(0,0,0,0.15)", background:"transparent", fontFamily:SN, marginBottom:24, outline:"none" }} />
                <input value={contactForm.email} onChange={e => setContactForm(p => ({...p, email:e.target.value}))} placeholder="E-Mail" type="email" style={{ width:"100%", padding:"16px 0", fontSize:15, border:"none", borderBottom:"1px solid rgba(0,0,0,0.15)", background:"transparent", fontFamily:SN, marginBottom:24, outline:"none" }} />
                <input value={contactForm.company} onChange={e => setContactForm(p => ({...p, company:e.target.value}))} placeholder="Unternehmen" style={{ width:"100%", padding:"16px 0", fontSize:15, border:"none", borderBottom:"1px solid rgba(0,0,0,0.15)", background:"transparent", fontFamily:SN, marginBottom:24, outline:"none" }} />
                <textarea value={contactForm.message} onChange={e => setContactForm(p => ({...p, message:e.target.value}))} placeholder="Ihre Nachricht – erzählen Sie uns von Ihren Räumen" style={{ width:"100%", padding:"16px 0", fontSize:15, border:"none", borderBottom:"1px solid rgba(0,0,0,0.15)", background:"transparent", fontFamily:SN, marginBottom:24, outline:"none", resize:"none", minHeight:100 }} />
                <button onClick={() => {
                  const subject = encodeURIComponent("Anfrage Kunstleasing" + (contactForm.company ? " – " + contactForm.company : ""));
                  const body = encodeURIComponent(
                    (contactForm.name ? "Name: " + contactForm.name + "\n" : "") +
                    (contactForm.email ? "E-Mail: " + contactForm.email + "\n" : "") +
                    (contactForm.company ? "Unternehmen: " + contactForm.company + "\n\n" : "\n") +
                    contactForm.message
                  );
                  window.open("mailto:info@kunstleasing.de?subject=" + subject + "&body=" + body, "_blank");
                  setFormSent(true);
                }} style={{ padding:"16px 48px", fontSize:11, fontWeight:500, letterSpacing:"0.15em", textTransform:"uppercase", border:"none", cursor:"pointer", background:"#000", color:"#fff", transition:"opacity 0.3s" }}>Nachricht senden</button>
              </div>
            )}
          </div>
        </div>
      )}

      {/* KI CHAT WIDGET */}
      {chatOpen && (
        <div style={{ position:"fixed", bottom:80, right:20, width:380, maxWidth:"calc(100vw - 40px)", height:520, maxHeight:"calc(100vh - 120px)", zIndex:20000, background:"#fff", boxShadow:"0 20px 60px rgba(0,0,0,0.2)", display:"flex", flexDirection:"column", borderRadius:0, border:"1px solid rgba(0,0,0,0.1)" }}>
          {/* Chat Header */}
          <div style={{ padding:"20px 24px", borderBottom:"1px solid rgba(0,0,0,0.08)", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
            <div>
              <div style={{ fontFamily:SF, fontSize:16, fontWeight:400 }}>Kunstberatung</div>
              <div style={{ fontSize:10, letterSpacing:"0.1em", textTransform:"uppercase", opacity:0.4, marginTop:4 }}>KI-Assistent</div>
            </div>
            <button onClick={() => setChatOpen(false)} style={{ background:"none", border:"none", fontSize:20, cursor:"pointer", opacity:0.4, padding:4, lineHeight:1 }}>✕</button>
          </div>
          {/* Chat Messages */}
          <div style={{ flex:1, overflowY:"auto", padding:"20px 24px", display:"flex", flexDirection:"column", gap:16 }}>
            {chatMsgs.map((m, i) => (
              <div key={i} style={{ display:"flex", justifyContent: m.role === "user" ? "flex-end" : "flex-start" }}>
                <div style={{ maxWidth:"85%", padding:"12px 16px", background: m.role === "user" ? "#000" : "#f5f5f5", color: m.role === "user" ? "#fff" : "#000", fontSize:13, lineHeight:1.6, borderRadius: m.role === "user" ? "16px 16px 4px 16px" : "16px 16px 16px 4px" }}>
                  {m.content}
                </div>
              </div>
            ))}
            {chatLoading && (
              <div style={{ display:"flex", justifyContent:"flex-start" }}>
                <div style={{ padding:"12px 16px", background:"#f5f5f5", fontSize:13, borderRadius:"16px 16px 16px 4px" }}>
                  <span style={{ opacity:0.5 }}>Einen Moment...</span>
                </div>
              </div>
            )}
            <div ref={chatEndRef} />
          </div>
          {/* Chat Input */}
          <div style={{ padding:"16px 24px", borderTop:"1px solid rgba(0,0,0,0.08)", display:"flex", gap:12, alignItems:"center" }}>
            <input
              value={chatInput}
              onChange={e => setChatInput(e.target.value)}
              onKeyDown={e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendChat(); } }}
              placeholder="Ihre Frage..."
              style={{ flex:1, padding:"12px 0", fontSize:14, border:"none", outline:"none", fontFamily:SN, background:"transparent" }}
            />
            <button onClick={sendChat} disabled={chatLoading || !chatInput.trim()} style={{ background:"none", border:"none", cursor: chatInput.trim() ? "pointer" : "default", padding:4, opacity: chatInput.trim() ? 1 : 0.2, transition:"opacity 0.2s" }}>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000" strokeWidth="2"><path d="M22 2L11 13"/><path d="M22 2L15 22L11 13L2 9L22 2Z"/></svg>
            </button>
          </div>
        </div>
      )}

      {/* CHAT TRIGGER BUTTON (when closed) */}
      {!chatOpen && (
        <button onClick={() => setChatOpen(true)} style={{ position:"fixed", bottom:70, right:20, zIndex:20000, width:56, height:56, borderRadius:"50%", background:"#000", color:"#fff", border:"none", cursor:"pointer", boxShadow:"0 4px 20px rgba(0,0,0,0.3)", display:"flex", alignItems:"center", justifyContent:"center", transition:"transform 0.2s" }}>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" strokeWidth="1.5"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        </button>
      )}

      {/* IMPRESSUM OVERLAY */}
      {showImpressum && (
        <div style={{ position:"fixed", inset:0, zIndex:30000, background:"rgba(255,255,255,0.98)", overflowY:"auto" }}>
          <div style={{ maxWidth:700, margin:"0 auto", padding:"100px 28px 80px" }}>
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:60 }}>
              <h2 style={{ fontFamily:SF, fontSize:"clamp(36px,8vw,60px)", fontWeight:300, lineHeight:1 }}>Impressum</h2>
              <button onClick={() => setShowImpressum(false)} style={{ background:"none", border:"none", fontSize:24, cursor:"pointer", opacity:0.4, padding:8 }}>✕</button>
            </div>
            <div style={{ display:"grid", gap:40 }}>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Angaben gemäß § 5 TMG</div>
                <p style={{ fontSize:15, lineHeight:1.8 }}>Kunstleasing Berlin<br/>Musterstraße 12<br/>10999 Berlin</p>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Kontakt</div>
                <p style={{ fontSize:15, lineHeight:1.8 }}>
                  Telefon: <a href="tel:+493012345678" style={{ color:"#000", textDecoration:"none", borderBottom:"1px solid rgba(0,0,0,0.2)" }}>+49 30 1234 5678</a><br/>
                  E-Mail: <a href="mailto:info@kunstleasing.de" style={{ color:"#000", textDecoration:"none", borderBottom:"1px solid rgba(0,0,0,0.2)" }}>info@kunstleasing.de</a>
                </p>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Vertreten durch</div>
                <p style={{ fontSize:15, lineHeight:1.8 }}>Johannes Weiß</p>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Umsatzsteuer-ID</div>
                <p style={{ fontSize:15, lineHeight:1.8 }}>Umsatzsteuer-Identifikationsnummer gemäß §27a Umsatzsteuergesetz:<br/>DE XXX XXX XXX</p>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Haftungsausschluss</div>
                <p style={{ fontSize:14, lineHeight:1.8, opacity:0.7 }}>Die Inhalte unserer Seiten wurden mit größter Sorgfalt erstellt. Für die Richtigkeit, Vollständigkeit und Aktualität der Inhalte können wir jedoch keine Gewähr übernehmen.</p>
              </div>
              <div>
                <div style={{ fontSize:10, letterSpacing:"0.2em", textTransform:"uppercase", opacity:0.4, marginBottom:12 }}>Urheberrecht</div>
                <p style={{ fontSize:14, lineHeight:1.8, opacity:0.7 }}>Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die Vervielfältigung, Bearbeitung, Verbreitung und jede Art der Verwertung außerhalb der Grenzen des Urheberrechtes bedürfen der schriftlichen Zustimmung des jeweiligen Autors bzw. Erstellers.</p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Footer */}
      <div style={{ position:"fixed", bottom:0, left:0, right:0, zIndex:50, padding:"18px 40px", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
        <span style={{ fontSize:9, letterSpacing:"0.03em", color: dark ? "#fff" : "#000" }}>© 2026 Kunstleasing</span>
        <div style={{ display:"flex", alignItems:"center", gap:12 }}>
          <a href="https://www.instagram.com/kunstleasing.berlin/" target="_blank" rel="noopener noreferrer" style={{ fontSize:9, color: dark ? "#fff" : "#000", textDecoration:"none", cursor:"pointer" }}>Instagram</a>
          <span style={{ opacity:0.4, color: dark ? "#fff" : "#000" }}>·</span>
          <span onClick={() => setShowImpressum(true)} style={{ fontSize:9, color: dark ? "#fff" : "#000", cursor:"pointer" }}>Impressum</span>
        </div>
      </div>
    </div>
  );
}
